@{
    ViewData["Title"] = "Home Page";
    var q = ViewBag.Q as string;
}

<div class="align-items-center mb-3">
    <form id="frmSearch" class="row flex-sm-wrap g-2 align-items-center justify-content-between mb-3"
          onsubmit="return submitSearch(event)">

        <div class="col-md-6 d-flex gap-2 justify-content-between justify-content-md-start">
            <div class="input-group">
                <input type="text" name="q" value="@ViewBag.Q"
                       id="searchInput"
                       class="form-control col-8"
                       placeholder="Tìm theo mã, tên, SĐT, email, địa chỉ..."
                       autocomplete="off" />
                <button type="button" id="clearBtn" 
                        class="btn btn-outline-secondary d-none"
                        onclick="clearSearch()">
                    X
                </button>
            </div>
            <div class="col-4 col-md-auto">
                <button class="btn btn-primary w-100 w-sm-auto">
                    <i class="bi bi-search"></i> Tìm kiếm
                </button>
            </div>
        </div>

        <div class="col-md-6 d-flex gap-2 justify-content-end">
            <div class="flex-row-1">
                <button type="button" id="btnDeleteSelected" class="btn btn-danger w-100 w-sm-auto d-none" onclick="deleteSelected()">
                    <i class="bi bi-trash"></i> Xoá đã chọn
                </button>
            </div>
            <div class="col-md-auto">
                <button type="button" class="btn btn-success w-100 w-sm-80"
                        onclick="openUpsert()">
                    <i class="bi bi-plus-lg"></i> Thêm nông dân
                </button>
            </div>
        </div>
    </form>
</div>

<!-- Chỗ để render bảng (partial _Table) -->
<div id="table-container"></div>

<!-- Form ẩn để lấy Anti-forgery token cho các request fetch -->
<form id="__af" asp-antiforgery="true" class="d-none"></form>

<!-- Modal Upsert: full screen -->
<div class="modal fade" id="modalUpsert" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thêm/Cập nhật nông dân</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modalUpsertBody">
                <!-- chổ này là nội dung form _Upsert sẽ được nạp ở đây -->
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script>
        document.addEventListener('DOMContentLoaded', () => loadTable());
    </script>
}
